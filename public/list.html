<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Words List</title>
	<link rel="stylesheet" href="lib/bootstrap.min.css">
	<link rel="stylesheet" href="lib/bootstrap-theme.min.css">
	<script src="lib/jquery-2.1.1.min.js"></script>
	<script src="lib/bootstrap.min.js"></script>
	<script src="util.js"></script>
</head>
<body style="background-color: silver;">

<div class="container">

	<div style="padding-top: 50px;"></div>
	<div class="row">
		<div class="col-md-12" style="padding: 0;">
			<div class="text-center" style="background-color: white; height: 750px; border: solid 1px silver;">
				<div style="height: 640px; margin: 20px auto 20px auto; ">
					<table id="wl" class="table table-striped" style=""></table>
				</div>
				<label id="info"></label>
				<button id="prev" class="btn btn-default btn-lg">Prev Page</button>
				<button id="next" class="btn btn-default btn-lg">Next Page</button>
				<span style="padding-left: 50px;"></span>
				<button id="selectall" class="btn btn-default btn-lg">Select All</button>
				<button id="delete" disabled class="btn btn-default btn-lg">Delete selected</button>
				<button id="gohome" class="btn btn-default btn-lg">Return Home</button>
			</div>
		</div>
	<div>
	
</div>

<script>
	var WordsOfPage = 16;
	var CurrentPage = 0;
	var MaxPage = -1;

	function ShowTable () {
		var wl = DB.load("list");
		var c = "<thead><tr><td>Select</td><td>Word</td><td>Review Number</td><td>Failure Time</td><td>Review Time</td><td>Add Time</td></tr></thead><tbody>";
		var count = 0;
		for (var i = CurrentPage * WordsOfPage; i < wl.length; i++) {
			var e = wl[i];
			var h = "<tr>";
			h += "<td><input type='checkbox' name=\'" + i + "\' >" + "</td>";
			h += "<td>" + e.word + "</td>";
			h += "<td>" + e.count + "</td>";
			h += "<td>" + e.fail + "</td>";
			h += "<td>" + DateToString(e.next) + "</td>";
			h += "<td>" + DateToString(e.date) + "</td>";
			h += "</tr>"
			c += h;
			count++;
			if (count >= WordsOfPage)
				break;
		}
		c += "</tbody>";
		$("#wl").html(c);
		
		if (wl.length <= 0) {
			$("#selectall").prop("disabled", true);
		} else {
			$("#selectall").prop("disabled", false);
		}
		
		if (wl.length > WordsOfPage) {
			MaxPage = Math.ceil(wl.length / WordsOfPage) - 1;
			if (CurrentPage >= MaxPage) {
				$("#next").prop("disabled", true);
			} else {
				$("#next").prop("disabled", false);
			}
			if (CurrentPage == 0) {
				$("#prev").prop("disabled", true);
			} else {
				$("#prev").prop("disabled", false);
			}
			
			$("#info").html("" + (CurrentPage + 1) + " of " + (MaxPage + 1) + " pages, " + wl.length + " words");
		} else {
			$("#prev").prop("disabled", true);
			$("#next").prop("disabled", true);
			$("#info").html("1 of 1 page, " + wl.length + " words");
		}
	}
	
	$(document).on("ready", function () {
		ShowTable();
	});
	
	
	$("#delete").on("click", function () {
		var cb = $("input:checked");
		var rmlist = [];
		for (var i = 0; i < cb.length; i++) {
			//console.log(cb[i].name);
			rmlist.push(cb[i].name);
		}
		
		Confirm("Are you sure deleting the selected?", function (yes) {
			if (yes) {
				var wl = DB.load("list");
				var nwl = [];
				for (var i in wl) {
					if (rmlist.indexOf(i) == -1)
						nwl.push(wl[i]);
				}
				DB.save("list", nwl);
				ShowTable();
			}
		});
	});
	
	$("#gohome").on("click", function () {
		window.location.href = "/";
	});
	
	
	$("#selectall").on("click", function () {
		var cb = $("input");
		if ($("input:checked").length == cb.length) {
			for (var i = 0; i < cb.length; i++) {
				$(cb[i]).prop("checked", false);
			}
			$("#delete").prop("disabled", true);
		} else {
			for (var i = 0; i < cb.length; i++) {
				$(cb[i]).prop("checked", true);
			}
			$("#delete").prop("disabled", false);
		}
	});
	
	$("#prev").on("click", function () {
		if (CurrentPage > 0) {
			CurrentPage--;
			ShowTable();
		}
	});
	
	$("#next").on("click", function () {
		if (CurrentPage < MaxPage) {
			CurrentPage++;
			ShowTable();
		}
	});
	
	$("#wl").on("change", function () {
		if ($("input:checked").length > 0) {
			$("#delete").prop("disabled", false);
		} else {
			$("#delete").prop("disabled", true);
		}
	});
</script>
</body>
</html>